"use strict";(("undefined"!=typeof self?self:global).webpackChunkopen=("undefined"!=typeof self?self:global).webpackChunkopen||[]).push([[6025],{22578:(e,t,r)=>{r.d(t,{$:()=>d});var a=r(67294),i=r(64593),n=r(96206),c=r(69691),s=r(8341),l=r(89952),o=r(51615),u=r(24183);function m(e){return e.includes("Spotify")?e:`Spotify – ${e}`}const d=({children:e,usePlayingItem:t})=>{let r=m(e);(e=>{const{mainLandmarkRef:t}=(0,u.Oh)(),r=(0,o.k6)(),i=r.location?.state?.preventMoveFocus,n=(0,a.useRef)(r.length<2);n.current=r.length<2,(0,a.useEffect)((()=>{const r=t.current;!i&&!n.current&&r&&e&&(r.setAttribute("aria-label",e),r.focus())}),[e,t,i])})(e);const{isPlaying:d}=(0,c.IK)(),g=(0,s.Y)((e=>e?.item));return g&&(d||t)&&((0,l.G_)(g)?r=[g.name,g.artists.map((e=>e.name)).join(n.ag.getSeparator())].join(" • "):(0,l.iw)(g)?r=[g.name,g.show.name].join(" • "):(0,l.k6)(g)&&(r=m(n.ag.get("ad-formats.advertisement")))),a.createElement(i.q,{defaultTitle:"Spotify",defer:!1},a.createElement("title",null,r))}},70369:(e,t,r)=>{r.d(t,{$:()=>a.$});var a=r(22578)},45253:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Le});var a=r(67294),i=r(20394),n=r(86706),c=r(69518),s=r.n(c),l=r(73012),o=r(87577),u=r(49207),m=r(31595),d=r(45106),g=r(8341),y=r(55799),v=r(49104),f=r(70369),p=r(10001),b=r(88767),E=r(96511),k=r(48015);var h=r(68120);function S(e,t,r){const{startTimeMs:a,words:i}=e,n=r[t+1];return{start:a||0,end:n&&n.startTimeMs?n.startTimeMs:1/0,text:i}}function L(e){const t=function(e){return{r:e>>16&255,g:e>>8&255,b:255&e}}(e);return k.I.fromRGB(t).toCSS(k.j.RGB)}const N=(e,t,r=!1)=>{const a=["lyrics",{uri:e,image:t,vocalRemoval:r}],{data:i,isLoading:n,isError:c}=(0,b.useQuery)(a,(async()=>e&&t&&s().isTrack(e)?await async function(e,t,r){try{const n=await(0,h.S)(e,t,r);return{hasLyrics:!0,isTimeSynced:(i=n.lyrics.syncType,"LINE_SYNCED"===i||"SYLLABLE_SYNCED"===i),syncType:n.lyrics.syncType,lyrics:n.lyrics.lines.map(S),colors:(a=n.colors,{text:L(a.text),activeText:L(a.highlightText),background:L(a.background)}),provider:n.lyrics.provider,providerDisplayName:n.lyrics.providerDisplayName,providerLyricsId:n.lyrics.providerLyricsId,hasVocalRemoval:n.hasVocalRemoval??!1}}catch(e){if(e instanceof E.m&&404===e.status)return{hasLyrics:!1};throw e}var a,i}(e,t,r):{hasLyrics:!1}),{cacheTime:18e5});return{data:i??null,loading:n,error:c}};var I=r(28760),w=r(81898),T=r(96206),x=r(23716),D=r(52759),_=r(54444),C=r(24643),B=r(8271);var G=r(97650),O=r(32648);const F="Q2RPoHcoxygOoPLXLMww",V="esRByMgBY3TiENAsbDHA",A="NHVfxGs2HwmI_fly2JC4",R="TDPh45khCfG51fNwNIiw",P="H2J92dVdr0ykdOX5azL1",Y="E64X_eoy6xsJmDdKKHja",H="W_EplVEAbZrZURqfLiQC",M="iq4cgi0YEKr6DGaTtzUj",U=a.memo((function({onObserve:e,text:t,lineNumber:r,activeLineIndex:n,isTimeSynced:c,handleLyricsClick:s}){const{ref:l,inView:o}=(0,G.YD)({threshold:0,triggerOnce:!0});(0,a.useEffect)((()=>{o&&e(t)}),[o,e,t]);const u=(0,a.useRef)(),m=(0,a.useRef)(!0),d=(0,a.useContext)(O.VX);(0,a.useEffect)((()=>{if(c&&n===r||c&&0===r&&n<0){const e=u.current?.getBoundingClientRect().top,t=d.scrollNodeRef.current?.getBoundingClientRect().height,r=t/4;if((e<r||e>t-r)&&!m.current&&n>=0)return;const a=m.current?"auto":"smooth";u.current?.scrollIntoView({behavior:a,block:"center",inline:"center"})}m.current=!1}),[n,c,r,u,d]);const g=(0,a.useCallback)((e=>{l(e),u.current=e||void 0}),[l]);return a.createElement("div",{dir:"auto",className:(0,i.cx)(A,{[R]:n===r,[P]:n>r,[Y]:!c}),"data-testid":"fullscreen-lyric",ref:g,onClick:e=>s(e,r)},t)})),W={start:0,end:1,text:""},z=a.memo((function({trackUri:e,data:t}){const{lyrics:r=[],provider:i,providerLyricsId:n,providerDisplayName:c,syncType:s,isTimeSynced:l}=t,{spec:o,logger:u}=(0,_.fU)(w.createDesktopLyricsEventFactory,{data:{uri:e}}),[m]=(0,D.z)(500,(t=>t?.item?.uri===e)),d=(0,g.Y)((e=>e?.playbackId??void 0)),y=function(e){const{trackUri:t,format:r,provider:i,providerLyricsId:n,syncType:c,playbackId:s}=e,[l,o]=(0,a.useState)(!1),[u,m]=(0,a.useState)(0),d=(0,a.useMemo)((()=>(0,C.N)({lyrics_format:r,track_uri:t,provider:i,provider_lyrics_id:n,sync_type:c,playback_id:s})),[r,i,n,c,t,s]);(0,a.useEffect)((()=>{o(!1),m(0)}),[d]);const g=(0,B.s4)();return(0,a.useEffect)((()=>{l||u>=140&&(g.send(d),o(!0))}),[u,l,d,g]),m}({trackUri:e,format:"fullscreen",provider:i,providerLyricsId:n,syncType:s,playbackId:d}),v=(0,a.useCallback)((e=>{e.length>1&&y((t=>t+e.length))}),[y]),f=(0,a.useMemo)((()=>[W,W,...r].map(((e,t)=>({...e,lineNumber:t})))),[r]),p=l?f.findIndex((({start:e,end:t})=>m>=e&&m<t)):-1,b=(0,x.g)(),E=(0,a.useCallback)(((e,t)=>{if(l){const r=f[t].start,a=o.lyricsLineFactory().hitSeekToTime({msToSeekTo:r});u.logInteraction(a);e.target.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),b.seekTo(r);const i=b.getState();i&&!i.isPaused||b.resume()}}),[l,u,f,b,o]);return a.createElement("div",{className:F},a.createElement("div",{className:V},!l&&a.createElement(I.Dy,{as:"p",variant:"mesto",className:M,dir:"auto"},T.ag.get("web-player.lyrics.unsynced")),f.map((({text:e,lineNumber:t})=>a.createElement(U,{key:t,text:e,lineNumber:t,activeLineIndex:p,isTimeSynced:l,onObserve:v,handleLyricsClick:E}))),c&&a.createElement(I.Dy,{as:"p",variant:"mesto",className:H,dir:"auto"},T.ag.get("web-player.lyrics.providedBy",c))))}));var J=r(38470);const q="hW9km7ku6_iggdWDR_Lg",K="IIFWQwWvkxpl3swKeHSx",Q="ihTTWcgqNLcQ_cg7Bubg",j="T67LFP0PElpfkkLuegQt",$="fSKBdxsPEB5WUAJWTYlh",X="YRcOaDMQH71HylItIhW6",Z="EKdvOmPl7kNCDg_yuma8",ee=a.memo((function({version:e}){const t=[T.ag.get("web-player.lyrics.noLyrics0"),T.ag.get("web-player.lyrics.noLyrics1"),T.ag.get("web-player.lyrics.noLyrics2"),T.ag.get("web-player.lyrics.noLyrics3")];let r;switch(e){case"ad":r=T.ag.get("web-player.lyrics.ad");break;case"error":r=T.ag.get("web-player.lyrics.error");break;case"unavailable":r=t[Math.floor(Math.random()*t.length)];break;default:(0,J.U)(e)}return a.createElement("div",{className:j},a.createElement("span",{className:Z},r))}));var te=r(94184),re=r.n(te),ae=r(57518),ie=r(7762),ne=r(27808),ce=r(26912),se=r(62312),le=r(41374),oe=r(32626),ue=r(30005),me=r(36652),de=r(21691),ge=r(66587);const ye="qnJd7AVNVGM33NxaibzG",ve="tPJJwfJAQV0WDsE9Kfmd",fe=[{volume:ge.B.SING_ALONG_OFF,icon:a.createElement(ae.D,{iconSize:16}),get label(){return T.ag.get("singalong.off")}},{volume:ge.B.HIGH,icon:a.createElement(ie.d,{iconSize:16}),get label(){return T.ag.get("singalong.more-vocal")}},{volume:ge.B.LOW,icon:a.createElement(ne.J,{iconSize:16}),get label(){return T.ag.get("singalong.less-vocal")}}],pe=a.memo((function({currentTrackUri:e}){const{isSupported:t,volume:r,setVocalVolume:i}=(e=>{const t=(0,y.$)(),[r,i]=(0,a.useState)(ge.B.SING_ALONG_OFF),{isSupported:n}=t.getCapabilities();return(0,a.useEffect)((()=>{t.setStatus(ge.q.DISABLED).then((()=>{i(ge.B.SING_ALONG_OFF)}))}),[e,t]),(0,a.useEffect)((()=>()=>{t.setStatus(ge.q.DISABLED)}),[t]),{isSupported:n,volume:r,setVocalVolume:(0,a.useCallback)((async e=>{e===ge.B.SING_ALONG_OFF?await t.setStatus(ge.q.DISABLED):await t.setStatus(ge.q.ENABLED),await t.setVocalVolume(e),i(e)}),[t])}})(e),n=(0,a.useCallback)((e=>{t&&i(e.volume)}),[t,i]);if(!t)return null;const c=fe.find((e=>e.volume===r)),s=c?.volume===ge.B.SING_ALONG_OFF;return a.createElement(oe.yj,{menu:a.createElement(ue.v,null,a.createElement(me.F,null,T.ag.get("singalong.title")),fe.map((e=>a.createElement(de.s,{role:"menuitemradio","aria-checked":r===e.volume,"aria-label":e.label,key:e.volume,onClick:()=>n(e),icon:e.icon,iconPosition:"leading"},e.label))))},((e,t,r)=>a.createElement("button",{onClick:t,ref:r,type:"button",className:re()(ye,{[ve]:s})},s?a.createElement(a.Fragment,null,a.createElement(ce.r,{iconSize:16}),a.createElement(I.Dy,{variant:"mesto"},T.ag.get("singalong.button"))):a.createElement(a.Fragment,null,c.icon,a.createElement(I.Dy,{variant:"mesto"},c.label)),e?a.createElement(se.U,{iconSize:16}):a.createElement(le.i,{iconSize:16}))))})),be=a.createElement("div",{className:Q},a.createElement(p.H,null)),Ee=a.createElement(ee,{version:"error"}),ke=a.createElement(ee,{version:"ad"}),he=a.createElement(ee,{version:"unavailable"}),Se={active:l.ixZ,inactive:l.Snx,background:l.tGJ,messaging:l.ixZ},Le=()=>{const e=(0,y.$)(),{isSupported:t}=e.getCapabilities(),r=(0,o.W6)(u.cp)&&t,c=(0,d.O)(),l=(0,g.Y)((e=>e?.item),((e,t)=>e?.uri===t?.uri)),p=l?.uri||"",b=(0,v.o)(l?.images||void 0,{desiredLabel:"large",desiredSize:600}),{data:E,loading:k,error:h}=N(p,b||l?.images?.[0]?.url||"",r);let S=Se;E?.hasLyrics&&(S={active:E.colors.activeText,inactive:E.colors.text,background:E.colors.background,messaging:E.colors.text}),(0,m.Y)(S.background,Se.background);const L=(0,g.Y)((e=>e?.nextItems?.[0]),((e,t)=>e?.uri===t?.uri));N(L?.uri||"",L?.images?.[0]?.url||"",r);let I=be,w=!1;if(p)if(s().isAd(p))I=ke;else if(h)I=Ee;else if(k)I=be;else if(E)if(E.hasLyrics){const e=c.activeDevice?.isLocal??!1;w=r&&E.hasVocalRemoval&&e,I=a.createElement(z,{trackUri:p,data:E,key:p})}else I=he;const T=(0,n.v9)((e=>e.ads.leaderboard.isEnabled)),x={"--lyrics-color-active":S.active,"--lyrics-color-inactive":S.inactive,"--lyrics-color-background":S.background,"--lyrics-color-messaging":S.messaging};return a.createElement(a.Fragment,null,a.createElement(f.$,{usePlayingItem:!0},"Spotify"),a.createElement("div",{className:(0,i.cx)(q,{[K]:T}),style:x},a.createElement("div",{className:$}),I,w?a.createElement("div",{className:X},a.createElement(pe,{currentTrackUri:p})):null))}}}]);
//# sourceMappingURL=xpui-routes-lyrics.js.map